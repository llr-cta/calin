//-*-mode:protobuf; mode:font-lock;-*-

/*

   calin/proto/simulations/sct_optics.proto -- Stephen Fegan -- 2021-04-23

   Protobufs for defining SCT optics arrays

   Copyright 2021, Stephen Fegan <sfegan@llr.in2p3.fr>
   Laboratoire Leprince-Ringuet, CNRS/IN2P3, Ecole Polytechnique, Institut Polytechnique de Paris

   This file is part of "calin"

   "calin" is free software: you can redistribute it and/or modify it
   under the terms of the GNU General Public License version 2 or
   later, as published by the Free Software Foundation.

   "calin" is distributed in the hope that it will be useful, but
   WITHOUT ANY WARRANTY; without even the implied warranty of
   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
   General Public License for more details.

*/

syntax = "proto3";

import "calin.proto";
import "common_types.proto";
import "simulation/vs_optics.proto";

package calin.ix.simulation.sct_optics;

// ============================================================================
//
// PARAMETERS THAT DEFINE CONCRETE ARRAY
//
// ============================================================================

message SCTFacetScheme
{
  double inner_ring_inner_radius                           = 1 [
    (CFO).desc = "Inner radius of inner ring or mirrors (distance between"
      "origin and line defining inner edge of facet).", (CFO).units="cm" ];
  double inner_ring_outer_radius                           = 2 [
    (CFO).desc = "Outer radius of inner ring or mirrors (distance between"
      "origin and line defining outer edge of facet).", (CFO).units="cm" ];
  double outer_ring_inner_radius                           = 3 [
    (CFO).desc = "Inner radius of outer ring or mirrors (distance between"
      "origin and line defining inner edge of facet).", (CFO).units="cm" ];
  double outer_ring_outer_radius                           = 4 [
    (CFO).desc = "Outer radius of outer ring or mirrors (distance between"
      "origin and line defining outer edge of facet).", (CFO).units="cm" ];
  double long_edge_half_gap                                = 5 [
    (CFO).desc = "Half the distance facets along their long edge.",
    (CFO).units="cm" ];
};

message SCTFacet
{
  uint32 id                                                = 1
    [(CFO).desc = "Sequential facet identification number, starting at zero."];
  bool removed                                             = 2
    [(CFO).desc = "True if this mirror facet has been removed."];
  double spot_size                                         = 3 [
    (CFO).desc = "Parameter describing spot size from this mirror in "
      "perfectly aligned system.", (CFO).units="cm" ];
  calin.ix.common_types.Vector3D offset                    = 4 [
    (CFO).desc = "Facet offset, if needed.", (CFO).units="cm" ];
  calin.ix.common_types.EulerAngles3D rotation             = 5 [
    (CFO).desc = "Facet rotation angles, if needed." ];
};

message SCTTelescope
{
  uint32 id                                                = 1
    [(CFO).desc = "Sequential telescope identification number, starting at zero."];
  common_types.Vector3D position                           = 2
    [(CFO).desc = "Position of the reflector center in the array frame. ",
     (CFO).units = "cm" ];

  repeated double primary_surface_polynomial               = 10 [
    (CFO).desc = "Coefficients describing primary surface sag. Coefficients "
      "are function of squared-distance from optic axis in cm.",
    (CFO).units = "cm" ];
  calin.ix.common_types.Vector3D primary_offset            = 11 [
    (CFO).desc = "Primary origin in reflector frame, if needed.", (CFO).units="cm" ];
  calin.ix.common_types.EulerAngles3D primary_rotation     = 12 [
    (CFO).desc = "Primary rotation matrix, if needed." ];
  SCTFacetScheme primary_facet_scheme                      = 13 [
    (CFO).desc = "Primary facet scheme." ];
  repeated SCTFacet primary_facets                         = 14 [
    (CFO).desc = "Primary facet parameters." ];
};

message SCTArray
{
  common_types.EarthCoordinates array_origin               = 1
    [(CFO).desc = "Coordinates of origin of array reference frame on Earth." ];
  repeated SCTTelescope telescope                          = 2
    [(CFO).desc = "Telescopes"];
};

// ============================================================================
//
// PARAMETERS USED TO CONSTRUCT RANDOM ARRAY
//
// ============================================================================

message SCTRandomArrayParameters
{
  common_types.EarthCoordinates array_origin               = 1
    [(CFO).desc = "Coordinates of origin of array reference frame on Earth"];
  calin.ix.simulation.vs_optics.UserDefinedArrayLayout array_layout = 2
    [(CFO).desc = "Coordinates of telescopes with respect to array"];
  double telescope_position_xy_dispersion                  = 3
    [(CFO).desc = "Dispersion in telescope positions in horizontal direcion",
    (CFO).units="cm" ];
  double telescope_position_z_dispersion                   = 4
    [(CFO).desc = "Dispersion in telescope positions in vertical direcion",
    (CFO).units="cm"];
  calin.ix.common_types.Vector3D reflector_origin          = 5 [
    (CFO).desc = "Offset of the reflector origin in the reflector frame  with "
      "respect to the telescope position, which is defined by the crossing of "
      "the drive axes. This allows an offset between the center of the nominal "
      "primary mirror surface and the drive axes to be accounted for. For "
      "example, a vector of (0,D,0) would put the reflector origin a distance "
      "D from the telescope position along the nominal optical axis.",
    (CFO).units="cm" ];

  double focal_length                                      = 10 [
    (CFO).desc = "Effective focal length of system.", (CFO).units = "cm" ];

  repeated double primary_sag_polynomial                   = 100 [
    (CFO).desc = "Coefficients describing primary surface sag. Coefficients "
      "are function of squared-distance from optic axis in units of cm.",
    (CFO).units = "cm", (CFO).ref="SCT-OPTMO/121108" ];
  calin.ix.common_types.Vector3D primary_offset            = 101 [
    (CFO).desc = "Primary origin in reflector frame, if needed.", (CFO).units="cm" ];
  double primary_offset_xz_dispersion                      = 102 [
    (CFO).desc = "Dispersion of primary position perpendicular to optic axis. This "
      "defines a per-telescope random component that is added to the primary offset "
      "specified by the \"primary_offset\" variable.",
    (CFO).units="cm" ];
  double primary_offset_y_dispersion                       = 103 [
    (CFO).desc = "Dispersion of primary position parallel to optic axis. This "
      "defines a per-telescope random component that is added to the primary_offset "
      "specified by the \"primary_offset\" variable.",
    (CFO).units="cm" ];
  calin.ix.common_types.EulerAngles3D primary_rotation     = 104 [
    (CFO).desc = "Primary rotation angles, if needed." ];
  double primary_rotation_dispersion                       = 105 [
    (CFO).desc = "Dispersion of primary direction. This defines a per-telescope "
      "random component that is compounded with the primary rotation angle "
      "specified by the \"primary_rotation\" variable.",
    (CFO).units="deg" ];
  SCTFacetScheme primary_facet_scheme                      = 106 [
    (CFO).desc = "Primary facet scheme." ];
  repeated uint32 primary_facets_removed                   = 107 [
    (CFO).desc = "List of primary facets removed." ];
  double primary_facet_offset_xz_dispersion                = 108 [
    (CFO).desc = "Dispersion of primary facet positions perpendicular to optic axis. This "
      "defines a per-facet random component that is added to the facet position.",
    (CFO).units="cm" ];
  double primary_facet_offset_y_dispersion                 = 109 [
    (CFO).desc = "Dispersion of primary facet positions parallel to optic axis. This "
      "defines a per-facet random component that is added to the facet position.",
    (CFO).units="cm" ];
  double primary_facet_rotation_dispersion                 = 110 [
    (CFO).desc = "Dispersion of primary facet direction. This defines a per-facet "
      "random scattering direction.",
    (CFO).units="deg" ];
  double primary_facet_spot_size                           = 111 [
    (CFO).desc = "Spot size from the primary facets.",
    (CFO).units="deg" ];

  double secondary_distance                                = 200 [
    (CFO).desc = "Position of secondary surface along optical axis at zero sag. "
      "This should be F/q in the nomenclature of SCT-OPTMO/121108.",
    (CFO).units = "cm", (CFO).ref="SCT-OPTMO/121108" ];
  repeated double secondary_sag_polynomial                 = 201 [
    (CFO).desc = "Coefficients describing secondary surface sag. Coefficients "
      "are function of squared-distance from optic axis in units of cm.",
    (CFO).units = "cm", (CFO).ref="SCT-OPTMO/121108" ];
  calin.ix.common_types.Vector3D secondary_offset          = 202 [
    (CFO).desc = "Secondary offset in reflector frame, if needed.", (CFO).units="cm" ];
  double secondary_offset_xz_dispersion                    = 203 [
    (CFO).desc = "Dispersion of secondary position perpendicular to optic axis. This "
      "defines a per-telescope random component that is added to the secondary offset "
      "specified by the \"secondary_offset\" variable.",
    (CFO).units="cm" ];
  double secondary_offset_y_dispersion                     = 204 [
    (CFO).desc = "Dispersion of secondary position parallel to optic axis. This "
      "defines a per-telescope random component that is added to the secondary offset "
      "specified by the \"secondary_offset\" variable.",
    (CFO).units="cm" ];
  calin.ix.common_types.EulerAngles3D secondary_rotation   = 205 [
    (CFO).desc = "Secondary rotation angles, if needed." ];
  double secondary_rotation_dispersion                     = 206 [
    (CFO).desc = "Dispersion of secondary direction. This defines a per-telescope "
      "random component that is compounded with the secondary rotation angle "
      "specified by the \"secondary_rotation\" variable.",
    (CFO).units="deg" ];
  SCTFacetScheme secondary_facet_scheme                    = 207 [
    (CFO).desc = "Secondary facet scheme." ];
  repeated uint32 secondary_facets_removed                 = 208 [
    (CFO).desc = "List of secondary facets removed." ];

  double camera_distance                                   = 300 [
    (CFO).desc = "Position of camera surface along optical axis at zero sag. "
      "This should be F*(1/q-(1-alpha)) in the nomenclature of SCT-OPTMO/121108, "
      "possibly adjusted for finite image focus distance and for the effects "
      "of the window.",
    (CFO).units = "cm", (CFO).ref="SCT-OPTMO/121108" ];
  repeated double camera_sag_polynomial                    = 301 [
    (CFO).desc = "Coefficients describing camera surface sag. Coefficients "
      "are function of squared-distance from optic axis in units of cm.",
    (CFO).units = "cm", (CFO).ref="SCT-OPTMO/121108" ];
  calin.ix.common_types.Vector3D camera_offset             = 302 [
    (CFO).desc = "Camera offset in reflector frame, if needed.", (CFO).units="cm" ];
  calin.ix.common_types.EulerAngles3D camera_rotation      = 303 [
    (CFO).desc = "Camera rotation angles, if needed." ];

  repeated calin.ix.simulation.vs_optics.VSOObscurationData primary_obscuration   = 40 [
    (CFO).desc = "Obscurations between photon emission and reflection at the "
      "primary mirror surface." ];
  repeated calin.ix.simulation.vs_optics.VSOObscurationData secondary_obscuration = 41 [
    (CFO).desc = "Obscurations between reflections at the primary and secondary "
      "mirror surfaces." ];
  repeated calin.ix.simulation.vs_optics.VSOObscurationData camera_obscuration    = 42 [
    (CFO).desc = "Obscurations between reflection at the secondary mirror and  "
      "reception at the camera surface." ];

  calin.ix.simulation.vs_optics.SphericalWindowParameters window = 50 [
    (CFO).desc = "Parameters of camera protection window." ];
};
